# ARM64 specific denylist

# Exclude KASan runtime
src:./osfmk/arm/machine_routines_common.c

# These use a local variable to work out which stack we're on, but can end up with
# a fakestack allocation.
fun:ml_at_interrupt_context
fun:ml_stack_remaining
fun:ml_stack_base
fun:ml_stack_size
fun:kernel_preempt_check

# Closure of pmap_in_ppl
fun:pmap_interrupts_disable
fun:pmap_get_cpu_data
fun:ml_get_ppl_cpu_data
fun:pmap_interrupts_restore

# These are required to fixup the kernelcache, which needs to happen before KASAN
# initialization on SPTM systems.
fun:arm_slide_rebase_and_sign_image
fun:kernel_collection_adjust_fileset_entry_addrs
fun:kernel_collection_adjust_mh_addrs
fun:PE_set_kc_header
fun:phystokv

# SPTM init
src:./osfmk/arm64/sptm/arm_init_sptm.c
src:./osfmk/arm64/static_if.c

# __SECURITY_STACK_DISALLOWED_PUSH
fun:sleh_panic_lockdown_should_initiate_el1_sp0_sync

# PAN Disabling functions (rdar://145659776&154299852)
fun:copyout
fun:copyin
fun:copyin_atomic32
fun:_unprivileged_copyin_atomic32_wait_if_equals
fun:copyin_atomic32_wait_if_equals
fun:copyin_atomic64
fun:copyout_atomic32
fun:copyout_atomic64
fun:copyinstr
fun:pmap_test_access
fun:user_access_enable
fun:pmap_get_tpro
fun:user_access_disable
